<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<script
  data-goatcounter="https://todepond.goatcounter.com/count"
  async
  src="//gc.zgo.at/count.js"></script>
<title>Tadi lab</title>
<link rel="shortcut icon" href="/favicon.png" />
<meta property="og:image" content="https://todepond.com/lab/og.png" />
<meta property="og:title" content="Tadi lab" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Tadi lab" />
<meta name="twitter:description" content="" />
<meta name="twitter:image" content="https://todepond.com/lab/og.png" />

<link rel="stylesheet" href="/style.css" />

<style>
  * {
    margin: 0;
    padding: 0;
    touch-action: none;
  }

  * {
    box-sizing: border-box;
  }

  canvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }
</style>

<canvas></canvas>

<script type="module">
  const canvas = document.querySelector("canvas");
  const context = canvas.getContext("2d");

  function handleResize() {
    canvas.width = window.innerWidth * devicePixelRatio;
    canvas.height = window.innerHeight * devicePixelRatio;
  }

  window.addEventListener("resize", handleResize);
  handleResize();

  const pointer = {
    position: [canvas.width / 2, canvas.height / 2],
    overlappingBall: false,
  };

  const ball = {
    position: [canvas.width / 2, canvas.height / 2],
  };

  const BALL_RADIUS = 10;
  const BALL_LINE_WIDTH = 2;

  function draw() {
    context.clearRect(0, 0, canvas.width, canvas.height);
    context.beginPath();
    context.arc(
      ball.position[0],
      ball.position[1],
      BALL_RADIUS * devicePixelRatio,
      0,
      Math.PI * 2
    );
    context.fillStyle = pointer.overlappingBall ? "white" : "rgb(31, 39, 54)";
    context.lineWidth = BALL_LINE_WIDTH * devicePixelRatio;
    context.fill();
    context.strokeStyle = "white";
    context.stroke();
  }

  const BALL_OVERLAP_GROWTH = 1.5;

  function updatePointerPosition(event) {
    pointer.position = [
      event.clientX * devicePixelRatio,
      event.clientY * devicePixelRatio,
    ];
    updateOverlaps();
  }

  function updateOverlaps() {
    const distanceToBall = Math.hypot(
      pointer.position[0] - ball.position[0],
      pointer.position[1] - ball.position[1]
    );
    const previous = pointer.overlappingBall;
    const radius = pointer.overlappingBall
      ? BALL_RADIUS * devicePixelRatio * BALL_OVERLAP_GROWTH
      : BALL_RADIUS * devicePixelRatio;
    pointer.overlappingBall = distanceToBall < radius * devicePixelRatio;
    if (previous !== pointer.overlappingBall) {
      draw();
      canvas.style.cursor = pointer.overlappingBall ? "pointer" : "default";
    }
  }

  addEventListener("pointermove", (event) => {
    updatePointerPosition(event);
  });

  addEventListener("pointerdown", (event) => {
    updatePointerPosition(event);
  });

  addEventListener("pointerup", (event) => {
    updatePointerPosition(event);
  });

  function tick() {
    draw();
    requestAnimationFrame(tick);
  }

  requestAnimationFrame(tick);
</script>
