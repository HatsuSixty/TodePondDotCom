<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<script
  data-goatcounter="https://todepond.goatcounter.com/count"
  async
  src="//gc.zgo.at/count.js"></script>
<title>Tadi lab</title>
<link rel="shortcut icon" href="/favicon.png" />
<meta property="og:image" content="https://todepond.com/lab/og.png" />
<meta property="og:title" content="Tadi lab" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Tadi lab" />
<meta name="twitter:description" content="" />
<meta name="twitter:image" content="https://todepond.com/lab/og.png" />

<link rel="stylesheet" href="/style.css" />

<!-- <h1>Frame</h1> -->

<input type="url" value="https://news.ycombinator.com/" />

<style>
  * {
    box-sizing: border-box;
  }

  #frame {
    width: 100%;
  }

  iframe {
    width: 100%;
    height: 500px;
    background-color: white;
  }
</style>

<article>
  <iframe srcdoc=""></iframe>
</article>

<script type="module">
  const input = document.querySelector("input");
  const iframe = document.querySelector("iframe");
  input.addEventListener("input", () => {
    loadUrl(input.value);
  });

  async function fetchSource(url) {
    const response = await fetch("https://todepond-fetchSource.web.val.run", {
      method: "POST",
      body: JSON.stringify({ url }),
    });
    const json = await response.json();
    // console.log(json);
    return json.source;
  }

  function renderSource(source) {
    iframe.srcdoc = source;
  }

  async function loadUrl(url) {
    const source = await fetchSource(url);
    renderSource(source);
  }

  loadUrl(input.value);
</script>
