<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<script
  data-goatcounter="https://todepond.goatcounter.com/count"
  async
  src="//gc.zgo.at/count.js"></script>
<title>Todepond dot com</title>
<link rel="shortcut icon" href="/favicon.png" />
<meta property="og:image" content="https://todepond.com/og.png" />
<meta property="og:title" content="Todepond dot com" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Todepond dot com" />
<meta name="twitter:description" content="" />
<meta name="twitter:image" content="https://todepond.com/og.png" />

<link rel="stylesheet" href="/style.css" />

<h1>Analytics</h1>

<table>
  <thead>
    <tr>
      <th>Count</th>
      <th>Path</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<style>
  th {
    text-align: left;
  }

  /* space between table columns */
  td {
    padding-right: 2em;
  }
</style>

<script type="module">
  const localData = localStorage.getItem("goatcounts");
  if (localData) {
    renderItems(JSON.parse(localData));
  }

  const response = await fetch("https://todepond-getgoatcounts.web.val.run");
  const data = await response.json();
  localStorage.setItem("goatcounts", JSON.stringify(data));

  renderItems(data);

  function renderItems(items) {
    const tbody = document.querySelector("tbody");
    tbody.innerHTML = "";
    for (const item of items) {
      const { path, count } = item;
      if (path === "/2" || path === "/1") {
        continue;
      }
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${count}</td>
        <td><a href="${path}">${path}</a></td>
      `;
      tbody.appendChild(tr);
    }
  }
</script>
